# Recipe REST Services

Backend services for a recipe web application, using:
* **NodeJS** version 12+
* **Express**
* **[nedb](https://www.npmjs.com/package/nedb)** for disk persistance.
* **Mocha + Chai** for unit testing.
* **[Istambul](https://www.npmjs.com/package/nyc)** for coverage.

Supports:
* Storing and retrieval of recipes
* Rate recipes
* Text search
* Best recipes

## Usage

### Start
```
    $ npm start [port]
```
If port is ommited, defaults to 8081. Don't forget to `npm install` after download.

### REST API

#### Create a recipe

##### Request

**URL:** `/recipes`
**Method:** `POST`
**Path variables:** none.
**Query parameters:** none.
**Request body:** JSON document representing a recipe.

Must have the following type:

```ts
    type Recipe = {
      name: String;
      ingredients: Ingredient[];
      steps: String[];
    }
    type Ingredient = {
      name: string;
      quantity: number;
      unit: string;
    }
```

At least one ingredient and one step must be provided.

##### Response

**status**
* `200` for Ok
* `400` if some required property is missing or has an invalid value.

**Response body**
The newly created recipe, including an autogenerated `id` property when creation succeded, or an object with the property `message` if something failed.

#### Retrieve a recipe

##### Request

**URL:** `/recipes/[id]`
**Method:** `GET`
**Path variables:**  `id` of a saved recipe
**Query parameters:** none.
**Request body:** none.

##### Response

**status**
* `200` for Ok
* `404` if there is not a recipe with such id.

**Response body**
The recipe, including it's `id` property and a `score` property, average of all it's ratings.

#### Retrieve all recipes (with an optional filter)

##### Request

**URL:** `/recipes`
**Method:** `GET`
**Path variables:**  none.
**Query parameters:** Can receive an optional `text` parameter for text search. If present and not empty, only recipes with given text in it's name or ingredients are returned.
**Request body:** none.

##### Response

**status**

* `200` for Ok

**Response body**
A list with all or matched recipes.

#### Top recipes in last days

##### Request

**URL:** `/recipes/best/[days]`
**Method:** `GET`
**Path variables:**  `days`, number of days until now. Must be a positive integer.
**Query parameters:** Can receive an optional `count` parameter to limit results.
**Request body:** none.

##### Response

**status**
* `200` for Ok
* `400` if `days` is not a valid positive integer.

**Response body**
A list with best recipes, considering only ratings added in the last `days` days, sorted in descending order by `score` and limited to `count` elements if given.

#### Rate a recipe

##### Request

**URL:** `/recipes/[id]/ratings`
**Method:** `POST`
**Path variables:**  `id` of a recipe.
**Query parameters:** none.
**Request body:** A JSON object with the property `stars`. It must be an integer from 1 to 5, both included.

##### Response

**status**

* `200` for Ok
* `400` if `stars` is not provided or it's not a valid positive integer from 1 to 5.
* `404` if `id` does not correspond to a saved recipe.

**Response body**
If succeeded, the newly created rating, which is an object that includes a `stars` property and a `time`, a timestamp. An object with the property `message` if something failed.

## Test

### Run tests

```
    $ npm test
```

### Run coverage
```
    $ npm run coverage
```

